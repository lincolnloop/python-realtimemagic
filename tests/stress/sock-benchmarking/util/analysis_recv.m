% Does graphing and analysis on data generated by the client tester. 

data = load('data.log')

% Sort by concurrency level, then messages per second. It comes out a
% little wonky from Java beacuse it's stored as a map.
data = sortrows(data, [1, 2]);

% now we want to make a graph that charts
concurrencyLevels = [25, 50, 75, 100, 200, 300, 400, 500, 750, 1000, 1250, 1500, 2000];

% color setup
colors = [0, 0, 127;
20, 0, 127;
40, 0, 127;
60, 0, 127;
80, 0, 127;
100, 0, 127;
120, 0, 127;
140, 0, 127;
160, 0, 127;
180, 0, 127;
200, 0, 127;
220, 0, 127;
240, 0, 127;
];
colors = colors/255;


i=1;
for concurrency = concurrencyLevels
    % get all the data for that concurrency level
    concurrency
    results = data(find(data(:, 1)==concurrency), :);
    
    
    % there are a few different graph options:
    
    % h = semilogy(results(:, 2), results(:, 5));    
    % h = semilogy(results(:, 2).*results(:, 1), results(:, 5));
    
    %h = plot(results(:, 2), results(:, 5));    
    h = plot(results(:, 2).*results(:, 1), results(:, 5));

    set(h, 'LineWidth', 2.0);
    set(h, 'Color', colors(i, :));
    i=i+1;
    hold on
end

h = xlabel('messages recv per second');
set(h, 'FontSize', 14);
h = ylabel('mean roundtrip time (ms)');
set(h, 'FontSize', 14);
set(gca, 'FontSize', 14);
set(gcf, 'Color', [1,1,1]);
%set(gcf, 'OuterPosition', [500, 1000, 900, 450]);

legend(num2str(concurrencyLevels'));

print('recv.png','-dpng')

